---
title: "Thesis Data Analysis"
date: "`r format(Sys.Date(), '%d %B, %Y')`"
output:
  pagedown::html_paged:
    css: www/my_css.css
    number_sections: no
knit: pagedown::chrome_print
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, class.source = "watch-out", options(scipen=999), out.width = "65%", warning = FALSE, comment = "") 
source("www/init.R")
source("www/Table_Design.R")
```

```{r, echo=FALSE}
htmltools::img(
  src = knitr::image_uri(file.path("www/BSM_Logo.png")), 
  alt = 'logo', 
  style = 'position:absolute; top:0; right:5px; padding:10px; width:200px'
)
```

```{r data, echo=FALSE, include=FALSE}
data <- read_excel("Main doc survey.xlsx")
attach(data)

dani <- c( "#ffa500", "#DAF7A6", "#34495E", "#69b3a2", "#ffd561", "#ee5c42", "#C8A2C8", "#5c3170", "#990000", "#C70039", "#34495E", "#909497")

pal9 <- jcolors("pal9")
```

## Steps data analysis

- Univariate descriptions - categorical variables

    - Data table

    - Graphs

- Univariate descriptions - numerical variables

    - Summary

    - Confidence intervals

    - Graphs

- Boxplots - numerical

- Joint distribution tables

- Outliers

- Parametric testing

- Relationships & correlations

    -   Residual plots

- Regressions

- Data problems

### Introduction

```{r}
dd <- as.data.frame(cbind(AmountWeek, AmountOutMonth, MoneyCoffee, MoneyGroceries, Subscription_Likely, App_Likely, AgeCategory, Education, Machine, Occupation, PurchaseLocation))

aggr(dd, numbers = TRUE, prop = c(TRUE, FALSE), cex.axis = 0.5)
```

The variables included in the data set are:

|                        Field | Description                                                                            |
|-----------------------------:|:---------------------------------------------------------------------------------------|
|                   AmountWeek | How many cups of coffee do you typically consume weekly?                               |
|               AmountOutMonth | How frequently do you drink out-of-home per month on average?                          |
|                  MoneyCoffee | How much money on average do you estimate you spend on coffee per month?               |
|               MoneyGroceries | How much on average do you spend on general groceries per month?                       |
|                      Machine | How do you brew your coffee at home?                                                   |
|                 Brand change | How often do you switch between coffee brands?                                         |
|            Purchase location | Where do you usually purchase your coffee?                                             |
| Supermarket_Positive_Reasons | When you purchase coffee from the supermarket what are your main reasons for doing so? |
| Supermarket_Negative_Reasons | What would be reasons why you would not purchase coffee from the supermarket?          |
|         Criteria_Type_Coffee | What are your main criteria's or evaluation points for choosing the type of coffee?    |
|              KnowledgeCoffee | How would you describe your knowledge level regarding coffee in general?               |
|               Purchase_Price | I believe that the \_\_\_\_ is important to my decision on which coffee to purchase.   |
|      Purchase_Sustainability | I believe that the \_\_\_\_ is important to my decision on which coffee to purchase.   |
|      Purchase_Sustainability | I believe that the \_\_\_\_ is important to my decision on which coffee to purchase.   |
|           Purchase_Fairtrade | I believe that the \_\_\_\_ is important to my decision on which coffee to purchase.   |
|           Purchase_Packaging | I believe that the \_\_\_\_ is important to my decision on which coffee to purchase.   |
|          Frequency_Specialty | How often do you drink specialty coffee?                                               |
|          Subscription_Likely | How likely are you to have an online subscription for (specialty) coffee?              |
|      Subscription_Not_Likely | What is the number one reasons why you would be hesitant?                              |
|                   App_Likely | How likely are you to value and use an app for your online subscription?               |
|                       Gender | What is your gender?                                                                   |
|                  AgeCategory | What is your age category?                                                             |
|                   Occupation | What is your occupational status?                                                      |
|                    Education | What level of education have you completed?                                            |
|                         Home | How would you describe the place you currently live in?                                |

------------------------------------------------------------------------
\newpage


### Univariate descriptions - Categorical variables

#### Age category

```{r, echo=FALSE}
Absolute <- data.table(Frequency = table(AgeCategory))
Relative <- percent(prop.table(Absolute$Frequency.N))
freqtable <- cbind(Absolute, Relative)
colnames(freqtable) <- c("Age Category", "Absolute", "Relative")

freqtable[,`Age Category`:= factor(
 `Age Category`, 
  levels = c(
    "< 18", 
    "18-25", 
    "25-45", 
    "45-60",
    "> 60"
  )
)]

setorder(freqtable, `Age Category`)

my_table(freqtable)
```

```{r, echo=FALSE}
newdata <- data.frame(
  Age=freqtable$`Age Category`,
  Frequency=freqtable$Absolute
)

ggplot(newdata, aes(y = Age, x = Frequency)) + 
  geom_bar(stat = "identity", fill="#69b3a2", color="#e9ecef") +
  theme(legend.position="none")
```

```{r, echo=FALSE}
dataB <- data.frame(
  group=freqtable$`Age Category`,
  value=freqtable$Relative
)

blank_theme <- theme_minimal()+
    theme(
        plot.title = element_text(size = 20, face = "bold")
    )
ggplot(dataB, aes(x="",y = value, fill = group)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  scale_fill_manual("Age category:", values = dani)+
  blank_theme  +
    theme(axis.text.x=element_blank(), 
          legend.title = element_text(face = "bold")) +
  geom_text(aes(x = 1.1, label = value),
              position = position_stack(vjust = 0.5),
              size = 3) +
  labs(title = "",
         x = "",
         y = ""
         )
```

#### Home

```{r, echo=FALSE}
Absolute <- data.table(Frequency = table(Home))
Relative <- percent(prop.table(Absolute$Frequency.N))
freqtable <- cbind(Absolute, Relative)
colnames(freqtable) <- c("Home", "Absolute", "Relative")

my_table(freqtable)
```

```{r, echo=FALSE}
newdata <- data.frame(
  Home=freqtable$`Home`,
  Frequency=freqtable$Absolute
)

ggplot(newdata, aes(y = Home, x = Frequency)) + 
  geom_bar(stat = "identity", fill="#69b3a2", color="#e9ecef") +
  theme(legend.position="none")
```

```{r, echo=FALSE}
dataB <- data.frame(
  group=freqtable$`Home`,
  value=freqtable$Relative
)

blank_theme <- theme_minimal()+
    theme(
        plot.title = element_text(size = 20, face = "bold")
    )
ggplot(dataB, aes(x="",y = value, fill = group)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  scale_fill_manual("Home description:", values = dani)+
  blank_theme  +
    theme(axis.text.x=element_blank(), 
          legend.title = element_text(face = "bold")) +
  geom_text(aes(x = 1.1, label = value),
              position = position_stack(vjust = 0.5),
              size = 3) +
  labs(title = "",
         x = "",
         y = ""
         )
```

#### Gender

```{r, echo=FALSE}
Absolute <- data.table(Frequency = table(Gender))
Relative <- percent(prop.table(Absolute$Frequency.N))
freqtable <- cbind(Absolute, Relative)
colnames(freqtable) <- c("Gender", "Absolute", "Relative")

my_table(freqtable)
```

```{r, echo=FALSE}
newdata <- data.frame(
  Gender=freqtable$`Gender`,
  Frequency=freqtable$Absolute
)

ggplot(newdata, aes(y = Gender, x = Frequency)) + 
  geom_bar(stat = "identity", fill="#69b3a2", color="#e9ecef") +
  theme(legend.position="none")
```

```{r, echo=FALSE}
dataB <- data.frame(
  group=freqtable$`Gender`,
  value=freqtable$Relative
)

blank_theme <- theme_minimal()+
    theme(
        plot.title = element_text(size = 20, face = "bold")
    )
ggplot(dataB, aes(x="",y = value, fill = group)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  scale_fill_manual("Gender:", values = dani)+
  blank_theme  +
    theme(axis.text.x=element_blank(), 
          legend.title = element_text(face = "bold")) +
  geom_text(aes(x = 1.1, label = value),
              position = position_stack(vjust = 0.5),
              size = 3) +
  labs(title = "",
         x = "",
         y = ""
         )
```

#### Education

```{r, echo=FALSE}
Absolute <- data.table(Frequency = table(Education))
Relative <- percent(prop.table(Absolute$Frequency.N))
freqtable <- cbind(Absolute, Relative)
colnames(freqtable) <- c("Education", "Absolute", "Relative")

freqtable[,`Education`:= factor(
 `Education`, 
  levels = c(
    "Elementary school", 
    "High school", 
    "Associate degree",
    "Bachelor's degree", 
    "Master",
    "Phd"
  )
)]

setorder(freqtable, `Education`)

my_table(freqtable)
```

```{r, echo=FALSE}
newdata <- data.frame(
  Education=freqtable$`Education`,
  Frequency=freqtable$Absolute
)

ggplot(newdata, aes(y = Education, x = Frequency)) + 
  geom_bar(stat = "identity", fill="#69b3a2", color="#e9ecef") +
  theme(legend.position="none")
```

```{r, echo=FALSE}
dataB <- data.frame(
  group=freqtable$`Education`,
  value=freqtable$Relative
)

blank_theme <- theme_minimal()+
    theme(
        plot.title = element_text(size = 20, face = "bold")
    )
ggplot(dataB, aes(x="",y = value, fill = group)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  scale_fill_manual("Education:", values = dani)+
  blank_theme  +
    theme(axis.text.x=element_blank(), 
          legend.title = element_text(face = "bold")) +
  geom_text(aes(x = 1.1, label = value),
              position = position_stack(vjust = 0.5),
              size = 3) +
  labs(title = "",
         x = "",
         y = ""
         )
```

#### Machine

```{r, echo=FALSE}
Absolute <- data.table(Frequency = table(Machine))
Relative <- percent(prop.table(Absolute$Frequency.N))
freqtable <- cbind(Absolute, Relative)
colnames(freqtable) <- c("Machine", "Absolute", "Relative")

my_table(freqtable)
```

```{r, echo=FALSE}
newdata <- data.frame(
  Machine=freqtable$`Machine`,
  Frequency=freqtable$Absolute
)

ggplot(newdata, aes(y = Machine, x = Frequency)) + 
  geom_bar(stat = "identity", fill="#69b3a2", color="#e9ecef") +
  theme(legend.position="none")
```

```{r, echo=FALSE}
dataB <- data.frame(
  group=freqtable$`Machine`,
  value=freqtable$Relative
)

blank_theme <- theme_minimal()+
    theme(
        plot.title = element_text(size = 20, face = "bold")
    )

ggplot(dataB, aes(x="",y = value, fill = group)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  scale_fill_manual("Machine:", values = dani)+
  blank_theme  +
    theme(axis.text.x=element_blank(), 
          legend.title = element_text(face = "bold")) +
  labs(title = "",
         x = "",
         y = ""
         )
```

#### Brand choose

```{r, echo=FALSE}
Absolute <- data.table(Frequency = table(BrandChange))
Relative <- percent(prop.table(Absolute$Frequency.N))
freqtable <- cbind(Absolute, Relative)
colnames(freqtable) <- c("Brand choice", "Absolute", "Relative")

freqtable[,`Brand choice`:= factor(
 `Brand choice`, 
  levels = c(
    "Never",
    "Sometimes",
    "Very often",
    "Every time"
  )
)]

setorder(freqtable, `Brand choice`)

my_table(freqtable)
```

```{r, echo=FALSE}
newdata <- data.frame(
  Brandchange=freqtable$`Brand choice`,
  Frequency=freqtable$Absolute
)

ggplot(newdata, aes(y = Brandchange, x = Frequency)) + 
  geom_bar(stat = "identity", fill="#69b3a2", color="#e9ecef") +
  theme(legend.position="none")
```

```{r, echo=FALSE}
dataB <- data.frame(
  group=freqtable$`Brand choice`,
  value=freqtable$Relative
)

blank_theme <- theme_minimal()+
    theme(
        plot.title = element_text(size = 20, face = "bold")
    )

ggplot(dataB, aes(x="",y = value, fill = group)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  scale_fill_manual("Brand chouce:", values = dani)+
  blank_theme  +
    theme(axis.text.x=element_blank(), 
          legend.title = element_text(face = "bold")) +
  geom_text(aes(x = 1.1, label = value),
              position = position_stack(vjust = 0.5),
              size = 3) +
  labs(title = "",
         x = "",
         y = ""
         )
```

#### Purchase Method

```{r, echo=FALSE}
Absolute <- data.table(Frequency = table(PurchaseLocation))
Relative <- percent(prop.table(Absolute$Frequency.N))
freqtable <- cbind(Absolute, Relative)
colnames(freqtable) <- c("Purchase Method", "Absolute", "Relative")

my_table(freqtable)
```

```{r, echo=FALSE}
newdata <- data.frame(
  PurchaseLocation=freqtable$`Purchase Method`,
  Frequency=freqtable$Absolute
)

ggplot(newdata, aes(y = PurchaseLocation, x = Frequency)) + 
  geom_bar(stat = "identity", fill="#69b3a2", color="#e9ecef") +
  theme(legend.position="none")
```

```{r, echo=FALSE}
dataB <- data.frame(
  group=freqtable$`Purchase Method`,
  value=freqtable$Relative
)

blank_theme <- theme_minimal()+
    theme(
        plot.title = element_text(size = 20, face = "bold")
    )

ggplot(dataB, aes(x="",y = value, fill = group)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  scale_fill_manual("Purchase method:", values = dani)+
  blank_theme  +
    theme(axis.text.x=element_blank(), 
          legend.title = element_text(face = "bold")) +
  geom_text(aes(x = 1.1, label = value),
              position = position_stack(vjust = 0.5),
              size = 3) +
  labs(title = "",
         x = "",
         y = ""
         )
```

### Multiple option answers:

#### Reasons buying from the supermarket

```{r}
# Reasons for buying from the supermarket
dt <- data.table(data)
dt[,id:=.I]

dt[
  ,
  (sprintf("super_market_pos_%i", c(1,2))):=tstrsplit(`Supermarket_Positive_ Reasons`,",")
][,`Supermarket_Positive_ Reasons`:=NULL]

dt_l <- na.omit(melt(dt, id.vars = "id", measure.vars = c("super_market_pos_1","super_market_pos_2")))

NSupermarket_Positive_Reasons <- dt_l[,table(value)]
my_table(NSupermarket_Positive_Reasons)
```


#### Reasons for not buying from the supermarket

```{r}
dt <- data.table(data)
dt[,id:=.I]

# Reasons for NOT buying from the supermarket

dt[
  ,
  (sprintf("super_market_neg_%i", c(1,2))):=tstrsplit(`Supermarket_Negative_ Reasons`,",")
][,`Supermarket_Negative_ Reasons`:=NULL]

dt_l <- na.omit(melt(dt, id.vars = "id", measure.vars = c("super_market_neg_1","super_market_neg_2")))

NSupermarket_Negative_Reasons <- dt_l[,table(value)]
NewTable<- as.data.table(NSupermarket_Negative_Reasons)
colnames(NewTable) <- c("Reason", "Frequency")
my_table(NewTable)
```

```{r, echo=FALSE}
Absolute <- data.table(Frequency = table(`Supermarket_Negative_ Reasons`))
Relative <- percent(prop.table(Absolute$Frequency.N))
freqtable <- cbind(Absolute, Relative)
colnames(freqtable) <- c("Negative reasons", "Absolute", "Relative")

my_table(freqtable)
```

```{r, echo=FALSE}
newdata <- data.frame(
  Negativereasons=freqtable$`Negative reasons`,
  Frequency=freqtable$Absolute
)

ggplot(newdata, aes(y = Negativereasons, x = Frequency)) + 
  geom_bar(stat = "identity", fill="#69b3a2", color="#e9ecef") +
  theme(legend.position="none")
```

#### Criteria for choosing the type of coffee

```{r}
dt <- data.table(data)
dt[,id:=.I]

# Criterias for choosing the type of coffee

dt[
  ,
  (sprintf("Criteria_type_%i", c(1,2))):=tstrsplit(Criteria_Type_Coffee,",")
][,`Criteria_Type_Coffee`:=NULL]

dt_l <- na.omit(melt(dt, id.vars = "id", measure.vars = c("Criteria_type_1","Criteria_type_2")))

NCriteria_Type_Coffee <- dt_l[,table(value)]
my_table(NCriteria_Type_Coffee)
```


#### Purchase decisions 1-5

##### Price

```{r, echo=FALSE}
Absolute <- data.table(Frequency = table(Purchase_Price))
Relative <- percent(prop.table(Absolute$Frequency.N))
freqtable1 <- cbind(Absolute, Relative)
colnames(freqtable1) <- c("Purchase decision - price", "Absolute", "Relative")

my_table(freqtable1)
```

```{r, echo=FALSE}
newdata <- data.frame(
  PurchasePrice=freqtable1$`Purchase decision - price`,
  Frequency=freqtable1$Absolute
)

ggplot(newdata, aes(y = Frequency, x = PurchasePrice)) + 
  geom_bar(stat = "identity", fill="#69b3a2", color="#e9ecef") +
  theme(legend.position="none")
```

```{r, echo=FALSE}
dataB <- data.frame(
  group=freqtable1$`Purchase decision - price`,
  value=freqtable1$Relative
)

blank_theme <- theme_minimal()+
    theme(
        plot.title = element_text(size = 20, face = "bold")
    )

ggplot(dataB, aes(x="",y = value, fill = group)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  scale_fill_manual("Decision:", values = dani)+
  blank_theme  +
    theme(axis.text.x=element_blank(), 
          legend.title = element_text(face = "bold")) +
  geom_text(aes(x = 1.1, label = value),
              position = position_stack(vjust = 0.5),
              size = 3) +
  labs(title = "Price",
         x = "",
         y = ""
         )
```

##### Sustainability

```{r, echo=FALSE}
Absolute <- data.table(Frequency = table(Purchase_Sustainability))
Relative <- percent(prop.table(Absolute$Frequency.N))
freqtable2 <- cbind(Absolute, Relative)
colnames(freqtable2) <- c("Purchase decision - sustainability", "Absolute", "Relative")

my_table(freqtable2)
```

```{r, echo=FALSE}
newdata <- data.frame(
  PurchaseSustainability=freqtable2$`Purchase decision - sustainability`,
  Frequency=freqtable2$Absolute
)

ggplot(newdata, aes(y = PurchaseSustainability, x = Frequency)) + 
  geom_bar(stat = "identity", fill="#69b3a2", color="#e9ecef") +
  theme(legend.position="none")
```

```{r, echo=FALSE}
dataB <- data.frame(
  group=freqtable2$`Purchase decision - sustainability`,
  value=freqtable2$Relative
)

blank_theme <- theme_minimal()+
    theme(
        plot.title = element_text(size = 20, face = "bold")
    )

ggplot(dataB, aes(x="",y = value, fill = group)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  scale_fill_manual("Decision:", values = dani)+
  blank_theme  +
    theme(axis.text.x=element_blank(), 
          legend.title = element_text(face = "bold")) +
  geom_text(aes(x = 1.1, label = value),
              position = position_stack(vjust = 0.5),
              size = 3) +
  labs(title = "Sustainability",
         x = "",
         y = ""
         )
```

##### Certificates

```{r, echo=FALSE}
Absolute <- data.table(Frequency = table(Purchase_Certificate))
Relative <- percent(prop.table(Absolute$Frequency.N))
freqtable3 <- cbind(Absolute, Relative)
colnames(freqtable3) <- c("Purchase decision - certificate", "Absolute", "Relative")

my_table(freqtable3)
```

```{r, echo=FALSE}
newdata <- data.frame(
  PurchaseCertificate=freqtable3$`Purchase decision - certificate`,
  Frequency=freqtable3$Absolute
)

ggplot(newdata, aes(y = PurchaseCertificate, x = Frequency)) + 
  geom_bar(stat = "identity", fill="#69b3a2", color="#e9ecef") +
  theme(legend.position="none")
```

```{r, echo=FALSE}
dataB <- data.frame(
  group=freqtable3$`Purchase decision - certificate`,
  value=freqtable3$Relative
)

blank_theme <- theme_minimal()+
    theme(
        plot.title = element_text(size = 20, face = "bold")
    )

ggplot(dataB, aes(x="",y = value, fill = group)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  scale_fill_manual("Decision:", values = dani)+
  blank_theme  +
    theme(axis.text.x=element_blank(), 
          legend.title = element_text(face = "bold")) +
  geom_text(aes(x = 1.1, label = value),
              position = position_stack(vjust = 0.5),
              size = 3) +
  labs(title = "Certificate",
         x = "",
         y = ""
         )
```

##### Fairtrade

```{r, echo=FALSE}
Absolute4 <- data.table(Frequency = table(Purchase_Fairtrade))
Relative <- percent(prop.table(Absolute4$Frequency.N))
freqtable4 <- cbind(Absolute4, Relative)
colnames(freqtable4) <- c("Purchase decision - fairtrade", "Absolute", "Relative")

my_table(freqtable4)
```

```{r, echo=FALSE}
newdata <- data.frame(
  PurchaseFairtrade=freqtable4$`Purchase decision - fairtrade`,
  Frequency=freqtable4$Absolute
)

ggplot(newdata, aes(y = PurchaseFairtrade, x = Frequency)) + 
  geom_bar(stat = "identity", fill="#69b3a2", color="#e9ecef") +
  theme(legend.position="none")
```

```{r, echo=FALSE}
dataB <- data.frame(
  group=freqtable4$`Purchase decision - fairtrade`,
  value=freqtable4$Relative
)

blank_theme <- theme_minimal()+
    theme(
        plot.title = element_text(size = 20, face = "bold")
    )

ggplot(dataB, aes(x="",y = value, fill = group)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  scale_fill_manual("Decision:", values = dani)+
  blank_theme  +
    theme(axis.text.x=element_blank(), 
          legend.title = element_text(face = "bold")) +
  geom_text(aes(x = 1.1, label = value),
              position = position_stack(vjust = 0.5),
              size = 3) +
  labs(title = "Fair trade",
         x = "",
         y = ""
         )
```

##### Packaging

```{r, echo=FALSE}
Absolute5 <- data.table(Frequency = table(Purchase_Packaging))
Relative <- percent(prop.table(Absolute5$Frequency.N))
freqtable5 <- cbind(Absolute5, Relative)
colnames(freqtable5) <- c("Purchase decision - packaging", "Absolute", "Relative")

my_table(freqtable5)
```

```{r, echo=FALSE}
newdata <- data.frame(
  PurchasePackaging=freqtable5$`Purchase decision - packaging`,
  Frequency=freqtable5$Absolute
)

ggplot(newdata, aes(y = PurchasePackaging, x = Frequency)) + 
  geom_bar(stat = "identity", fill="#69b3a2", color="#e9ecef") +
  theme(legend.position="none")
```

```{r, echo=FALSE}
dataB <- data.frame(
  group=freqtable5$`Purchase decision - packaging`,
  value=freqtable5$Relative
)

blank_theme <- theme_minimal()+
    theme(
        plot.title = element_text(size = 20, face = "bold")
    )

ggplot(dataB, aes(x="",y = value, fill = group)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  scale_fill_manual("Decision:", values = dani)+
  blank_theme  +
    theme(axis.text.x=element_blank(), 
          legend.title = element_text(face = "bold")) +
  geom_text(aes(x = 1.1, label = value),
              position = position_stack(vjust = 0.5),
              size = 3) +
  labs(title = "Packaging",
         x = "",
         y = ""
         )
```

### Combined data

```{r}
Combined_data <- as.data.frame(cbind(Absolute, freqtable1[,Absolute], freqtable2[,Absolute], freqtable3[,Absolute], freqtable4[,Absolute]))
colnames(Combined_data) <- c("Importance", "Price", "Sustainability", "Certificates", "Fairtrade", "Packaging")
my_table(Combined_data)
```

```{r}
Combined_data %>%
  gather(key, value, -Importance) %>% 
  ggplot(aes(x=Importance, y=value, fill = key)) +
   scale_fill_manual("Purchase decision:", values = dani)+
    geom_col(position = "dodge") +
      ylab("Frequency") +
      xlab("Importance")
```


```{r}
# creating a dataset
Factor <- c(rep("Price", 5), rep("Sustainability", 5), rep("Certificates", 5), rep("Fairtrade", 5),  rep("Packaging",5))

condition <- rep(Combined_data$Importance,5)
value <- c(freqtable1[,Absolute], freqtable2[,Absolute], freqtable3[,Absolute], freqtable4[,Absolute], freqtable5[,Absolute])
dataN <- data.frame(Factor,condition,value)
 
# Plotting the graph
ggplot(dataN, aes(fill=condition, y=value, x=condition)) + 
    geom_bar(position="dodge", stat="identity") +
    ggtitle("Importance of several factors on the purchasing decision.") +
    scale_fill_manual(values = dani)+
    facet_wrap(~Factor) +
    theme_ipsum() +
    theme(legend.position="none",plot.title = element_text(size=16, face="bold")) +
    xlab("1: Not important at all, 5: Extremely important") +
    ylab("Frequency")
```


#### Frequency specialty coffee consumption

```{r, echo=FALSE}
Absolute <- data.table(Frequency = table(Frequency_Specialty))
Relative <- percent(prop.table(Absolute$Frequency.N))
freqtable <- cbind(Absolute, Relative)
colnames(freqtable) <- c("Frequency coffee consumption", "Absolute", "Relative")

freqtable[,`Frequency coffee consumption`:= factor(
 `Frequency coffee consumption`, 
  levels = c(
    "I do (did) not know what this is", 
    "Never", 
    "Only in cafes", 
    "Sometimes",
    "Always"
  )
)]

setorder(freqtable, `Frequency coffee consumption`)

my_table(freqtable)
```

```{r, echo=FALSE}
newdata <- data.frame(
  FrequencyConsumption=freqtable$`Frequency coffee consumption`,
  Frequency=freqtable$Absolute
)

ggplot(newdata, aes(y = FrequencyConsumption, x = Frequency)) + 
  geom_bar(stat = "identity", fill="#69b3a2", color="#e9ecef") +
  theme(legend.position="none")
```

#### Reasons for not being likely to set up a subscription

```{r}
dt <- data.table(data)
dt[,id:=.I]

# Reasons for not being likely to setup a subscription
dt[
  ,
  (sprintf("Subscription_Not_Likely_%i", c(1,2))):=tstrsplit(Subscription_Not_Likely,",")
][,Subscription_Not_Likely:=NULL]

dt_l <- na.omit(melt(dt, id.vars = "id", measure.vars = c("Subscription_Not_Likely_1","Subscription_Not_Likely_2")))

NSubscription_Not_Likely <- dt_l[,table(value)]
my_table(NSubscription_Not_Likely)
```

```{r, echo=FALSE}
Absolute <- data.table(Frequency = table(Subscription_Not_Likely))
Relative <- percent(prop.table(Absolute$Frequency.N))
freqtable <- cbind(Absolute, Relative)
colnames(freqtable) <- c("Reasons", "Absolute", "Relative")

my_table(freqtable)
```

```{r, echo=FALSE}
newdata <- data.frame(
  Reasons=freqtable$Reasons,
  Frequency=freqtable$Absolute
)

ggplot(newdata, aes(y = Reasons, x = Frequency)) + 
  geom_bar(stat = "identity", fill="#69b3a2", color="#e9ecef") +
  theme(legend.position="none")
```

------------------------------------------------------------------------

\newpage

### Univariate descriptions - Numerical variables

#### Amount coffe consumed weekly

```{r}
summary(AmountWeek)
```

```{r, echo=FALSE}
n <- length(AmountWeek)

binwidth <- 2
ggplot(data = data, aes(AmountWeek) ) + 
    geom_histogram(binwidth = 2, fill="#69b3a2", color="#e9ecef", alpha=0.9) +    
    stat_function(fun = function(x) dnorm(x, mean(data$AmountWeek), sd = sd(data$AmountWeek)) * n * binwidth,
    color = "black", size = 0.6) +
    ggtitle("How many cups of coffee do you consume per week?") +
      xlab("Cups of coffee") +
      ylab("Frequency") +
 theme(plot.title = element_text(hjust = 0.5, size=11, face="bold"))
```

#### Amount per month out of house

```{r}
summary(AmountOutMonth)
```

```{r, echo=FALSE}
n <- length(AmountOutMonth)

binwidth <- 2
ggplot(data = data, aes(AmountOutMonth) ) + 
    geom_histogram(binwidth = 2, fill="#69b3a2", color="#e9ecef", alpha=0.9) +    
    stat_function(fun = function(x) dnorm(x, mean(data$AmountOutMonth), sd = sd(data$AmountOutMonth)) * n * binwidth,
    color = "black", size = 0.6) +
    ggtitle("How many cups of coffee do you consume out of house per month?") +
      xlab("Cups of coffee") +
      ylab("Frequency") +
 theme(plot.title = element_text(hjust = 0.5, size=11, face="bold"))
```

#### Money coffee

```{r}
summary(MoneyCoffee)
```

```{r, echo=FALSE}
n <- length(MoneyCoffee)

binwidth <- 4
ggplot(data = data, aes(MoneyCoffee) ) + 
    geom_histogram(binwidth = 4, fill="#69b3a2", color="#e9ecef", alpha=0.9) +    
    stat_function(fun = function(x) dnorm(x, mean(data$MoneyCoffee), sd = sd(data$MoneyCoffee)) * n * binwidth,
    color = "black", size = 0.6) +
    ggtitle("How much money do you spend on average on coffee?") +
      xlab("Amount in Euros") +
      ylab("Frequency") +
 theme(plot.title = element_text(hjust = 0.5, size=11, face="bold"))
```

#### Money groceries

```{r}
summary(MoneyGroceries)
```

```{r, echo=FALSE}
n <- length(MoneyGroceries)

binwidth <- 20
ggplot(data = data, aes(MoneyGroceries) ) + 
    geom_histogram(binwidth = 20, fill="#69b3a2", color="#e9ecef", alpha=0.9) +    
    stat_function(fun = function(x) dnorm(x, mean(data$MoneyGroceries), sd = sd(data$MoneyGroceries)) * n * binwidth,
    color = "black", size = 0.6) +
    ggtitle("How much money do you spend on average on groceries?") +
      xlab("Amount in Euros") +
      ylab("Frequency") +
 theme(plot.title = element_text(hjust = 0.5, size=11, face="bold"))
```

#### Subscription likely

```{r}
summary(Subscription_Likely)
```

```{r, echo=FALSE}
n <- length(Subscription_Likely)

binwidth <- 1
ggplot(data = data, aes(Subscription_Likely) ) + 
    geom_histogram(binwidth = 1, fill="#69b3a2", color="#e9ecef", alpha=0.9) +    
    ggtitle("How likely are you to set up an subscription?") +
      xlab("Likeliness") +
      ylab("Frequency") +
 theme(plot.title = element_text(hjust = 0.5, size=11, face="bold"))
```

#### App likely

```{r}
summary(App_Likely)
```

```{r, echo=FALSE}
n <- length(App_Likely)

binwidth <- 1
ggplot(data = data, aes(App_Likely) ) + 
    geom_histogram(binwidth = 1, fill="#69b3a2", color="#e9ecef", alpha=0.9) +    
    ggtitle("How likely are you to set up an app?") +
      xlab("Likeliness") +
      ylab("Frequency") +
 theme(plot.title = element_text(hjust = 0.5, size=11, face="bold"))
```

------------------------------------------------------------------------

\newpage

### Boxplots

```{r, echo=FALSE}
AmountWeek <- as.numeric(AmountWeek)

box1 <- ggplot(data=data, aes(x=AmountWeek, y="", fill="")) +
    geom_boxplot(fill="#69b3a2", outlier.colour="red", outlier.shape=8, outlier.size=4) +
    theme_ipsum() +
    theme(
      legend.position="none",
      plot.title = element_text(size=15)
      ) +
    ggtitle("Weekly coffee consumption") +
    theme(plot.title = element_text(hjust = 0.5)) +
    xlab("")+
    ylab("Quantity")

box2 <- ggplot(data=data, aes(x=AmountOutMonth, y="", fill="")) +
    geom_boxplot(fill="#69b3a2", outlier.colour="red", outlier.shape=8, outlier.size=4) +
    theme_ipsum() +
    theme(
      legend.position="none",
      plot.title = element_text(size=15)
      ) +
    ggtitle("Monthly out of house coffee consumption") +
    theme(plot.title = element_text(hjust = 0.5)) +
    xlab("")+
    ylab("Quantity")

grid.arrange(box1, box2, nrow=2)
```

```{r}
box3 <- ggplot(data=data, aes(x=MoneyCoffee, y="", fill="")) +
    geom_boxplot(fill="#69b3a2", outlier.colour="red", outlier.shape=8, outlier.size=4) +
    theme_ipsum() +
    theme(
      legend.position="none",
      plot.title = element_text(size=15)
      ) +
    ggtitle("Amount of money spend on coffee") +
    theme(plot.title = element_text(hjust = 0.5)) +
    xlab("")+
    ylab("Quantity")


box4 <- ggplot(data=data, aes(x=MoneyGroceries, y="", fill="")) +
    geom_boxplot(fill="#69b3a2", outlier.colour="red", outlier.shape=8, outlier.size=4) +
    theme_ipsum() +
    theme(
      legend.position="none",
      plot.title = element_text(size=15)
      ) +
    ggtitle("Amount spend on Groceries") +
    theme(plot.title = element_text(hjust = 0.5)) +
    xlab("")+
    ylab("Quantity")

grid.arrange(box3, box4, nrow=2)

box5 <- ggplot(data=data, aes(x=Subscription_Likely, y="", fill="")) +
    geom_boxplot(fill="#69b3a2", outlier.colour="red", outlier.shape=8, outlier.size=4) +
    theme_ipsum() +
    theme(
      legend.position="none",
      plot.title = element_text(size=15)
      ) +
    ggtitle("How likely are you to set up an subscription") +
    theme(plot.title = element_text(hjust = 0.5)) +
    xlab("")+
    ylab("Quantity")

box6 <- ggplot(data=data, aes(x=App_Likely, y="", fill="")) +
    geom_boxplot(fill="#69b3a2", outlier.colour="red", outlier.shape=8, outlier.size=4) +
    theme_ipsum() +
    theme(
      legend.position="none",
      plot.title = element_text(size=15)
      ) +
    ggtitle("How likely are you to value and use an app?") +
    theme(plot.title = element_text(hjust = 0.5)) +
    xlab("")+
    ylab("Quantity")

grid.arrange(box5, box6, nrow=2)

box6 <- ggplot(data=data, aes(x=KnowledgeCoffee, y="", fill="")) +
    geom_boxplot(fill="#69b3a2", outlier.colour="red", outlier.shape=8, outlier.size=4) +
    theme_ipsum() +
    theme(
      legend.position="none",
      plot.title = element_text(size=15)
      ) +
    ggtitle("Level of coffee knowledge") +
    theme(plot.title = element_text(hjust = 0.5)) +
    xlab("")+
    ylab("Quantity")
```

------------------------------------------------------------------------

\newpage

### Parametric testing

H_0 \<- There is no association between the two variables. \
H_a \<- There is a association.

Age - Amount coffee drank

```{r}
chisq.test(AmountWeek, AgeCategory)
chisq.test(AmountWeek, AgeCategory, simulate.p.value = TRUE, B = 500)
```

Education - Amount coffee drank

```{r}
chisq.test(AmountWeek, Education)
chisq.test(AmountWeek, Education, simulate.p.value = TRUE, B = 500)
```

Gender - Amount coffee drank

```{r}
chisq.test(AmountWeek, Gender)
chisq.test(AmountWeek, Gender, simulate.p.value = TRUE, B = 500)
```

Home - Amount coffee drank

```{r}
chisq.test(AmountWeek, Home)
chisq.test(AmountWeek, Home, simulate.p.value = TRUE, B = 500)
```

App - Age

```{r}
chisq.test(App_Likely, AgeCategory)
chisq.test(App_Likely, AgeCategory, simulate.p.value = TRUE, B = 500)
```

Coffee knowledge - Age

```{r}
chisq.test(KnowledgeCoffee, AgeCategory)
chisq.test(KnowledgeCoffee, AgeCategory, simulate.p.value = TRUE, B = 500)
```

Coffee knowledge - Purchase location

```{r}
chisq.test(KnowledgeCoffee, PurchaseLocation)
chisq.test(KnowledgeCoffee, PurchaseLocation, simulate.p.value = TRUE, B = 500)
```

------------------------------------------------------------------------

\newpage

### Relationships

```{r, echo=FALSE, out.width="110%"}
newdata <- data.frame(AmountWeek, AmountOutMonth, MoneyCoffee, MoneyGroceries, KnowledgeCoffee, Subscription_Likely, Machine)

pairs.panels(newdata,
method = "pearson",
hist.col = "#00AFBB",
density = TRUE,
ellipses = TRUE
)
```

```{r}
# Density plots with semi-transparent fill

ggplot(data = data, aes(x= AmountWeek, fill=Gender)) + geom_density(alpha=.3) +

    theme(

      plot.title = element_text(size=15)

      ) +

    ggtitle("Coffee consumption by gender") +

    theme(plot.title = element_text(hjust = 0.5, face= "bold")) +

    xlab("")+

    ylab("Density")
```

```{r}
# Density plots with semi-transparent fill

ggplot(data = data, aes(x= AmountWeek, fill=AgeCategory)) + geom_density(alpha=.3) +

    theme(

      plot.title = element_text(size=15)

      ) +

    ggtitle("Coffee consumption by Age") +

    theme(plot.title = element_text(hjust = 0.5, face= "bold")) +

    xlab("")+

    ylab("Density")
```


```{r}
 ggplot(data, aes(y = AmountWeek, x = MoneyCoffee)) +
  geom_point(size=1) +
  geom_smooth(method="lm", fill = NA, color="#69b3a2", fullrange=TRUE, formula = y ~ x) +
   theme(plot.title = element_text(hjust = 0.5)) +
        labs(title = "Amount of coffee consumer by the amount of money spend",
         y = "Coffee cups consumer per week",
         x = "Amount spend on coffee per month"
         )
```

```{r}
 ggplot(data, aes(y = AmountWeek, x = MoneyGroceries)) +
  geom_point(size=1) +
  geom_smooth(method="lm", fill = NA, color="#69b3a2", fullrange=TRUE, formula = y ~ x) +
   theme(plot.title = element_text(hjust = 0.5)) +
        labs(title = "Amount of coffee consumer by the amount of money spend on groceries",
         y = "Coffee cups consumer per week",
         x = "Amount spend on groceries per month"
         )
```

------------------------------------------------------------------------

\newpage

### Regressions

```{r}
summary(lm(Subscription_Likely~KnowledgeCoffee))
```

Incl categorical variables as dummies

Cooks distance --\> outliers

------------------------------------------------------------------------

\newpage

### Data problems
